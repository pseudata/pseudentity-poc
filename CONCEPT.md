# Concept: Pseudentity.dev

**Tagline:** "Deterministic Identity for Development."
**Role:** The official visual companion and OIDC provider for the `pseudata` library.

---

## 1. The Mission
While `pseudata` provides the *engine* for generating consistent test data across languages, `pseudentity.dev` provides the *interface*. It acts as:
1.  **A Profile Viewer:** Instantly visualize any "fake user" generated by the library.
2.  **An OpenID Provider:** Allow developers to "Login with Pseudentity" in their apps.
3.  **An Enterprise Mock:** Simulate complex provisioning flows (SCIM) without expensive SaaS subscriptions.

## 2. Visual Identity
* **Aesthetic:** Industrial, High-Tech, Cyberpunk, "Sandbox".
* **Palette:**
    * **Primary:** Soft Violet (`#8b5cf6`) — distinguishing it from the "Steel Blue" of the documentation.
    * **Base:** Black & White (Monochrome UI with accent highlights).
* **Logo:** A square, abstract "Split Face" (Half Human / Half Wireframe).

---

## 3. Core Architecture
The system is **entirely stateless**. It uses CPU (Math) instead of Storage (Disk).

### The "PseudoID" (UUID v8)
The core innovation is the **PseudoID**. Instead of a random database key, it is a standard **RFC 9562 UUID v8** that encodes the generation parameters directly into the 128-bit space.

**Bit Layout (128 bits total):**
`SSSSSSSS-SSSS-8SSS-vSTT-TTIIIIIIIII`

| Component | Size | Description |
| :--- | :--- | :--- |
| **World Seed** | **64 bits** | The universe ID (e.g., `42`). Supports `uint64`. |
| **Type Seq** | **16 bits** | The object type (e.g., `101` = User, `105` = Address). |
| **Index** | **40 bits** | The specific record position (0 to 1.1 Trillion). |
| **Version** | 4 bits | Fixed as `8` (UUID v8). |
| **Variant** | 2 bits | Fixed as `10` (RFC Standard). |
| **Skip** | 2 bits | Reserved/Padding (Currently `00`). |

This allows any server to "inflate" the full user profile instantly just by looking at the ID.

---

## 4. URL Structure

The site is divided into four distinct namespaces.

### A. The Profile Namespace (`/u/`)
*Human-readable representations of a specific identity.*

| URL Pattern | Type | Description |
| :--- | :--- | :--- |
| `/u/{uuid}` | `HTML` | **The Profile App.** Renders the Svelte UI. |
| `/u/{uuid}/data.json` | `JSON` | Raw object (Name, Bio, Job) for API fetching. |
| `/u/{uuid}/contact.vcf`| `VCF` | **VCard 4.0** file for importing to mobile Contacts. |
| `/u/{uuid}/avatar.png`| `PNG` | Deterministic avatar (Identicon/SVG). |
| `/u/{uuid}/cover.png` | `PNG` | Deterministic background/banner image. |
| `/u/{uuid}/qr.png` | `PNG` | QR Code for mobile scanning. |
| `/u/lookup` | `307` | **Redirector.** Converts `?seed=X` params into a canonical `/u/{uuid}` URL. |

### B. The Factory Namespace (`/api/`)
*Machine endpoints to generate/search for identities.*

| URL Pattern | Method | Description |
| :--- | :--- | :--- |
| `/api/v1/user` | `GET` | Params: `?seed=X&index=Y`. Returns `{ id, url, ...data }`. |
| `/api/v1/company` | `GET` | *(Future)* Returns Company object + ID. |

### C. The OIDC Namespace (`/oidc/`)
*Authentication protocol endpoints.*

| URL Pattern | Description |
| :--- | :--- |
| `/oidc/authorize` | The "Login Screen". User inputs a Seed or UUID. |
| `/oidc/token` | Standard OIDC token exchange (Stateless, signed JWTs). |
| `/oidc/introspect`| Validates if a token signature is active (RFC 7662). |
| `/oidc/userinfo` | Returns the profile data for the authenticated token. |
| `/.well-known/...` | OpenID Connect Discovery document. |

### D. The Enterprise Namespace (`/scim/v2/`)
*Mock SCIM 2.0 endpoints for testing user provisioning.*

| URL Pattern | Method | Description |
| :--- | :--- | :--- |
| `/scim/v2/Users` | `GET` | List users (Simulates pagination via O(1) access). |
| `/scim/v2/Users/{id}`| `GET` | Returns RFC 7643 compliant user schema. |

---

## 5. Technical Stack

| Component | Choice | Rationale |
| :--- | :--- | :--- |
| **Framework** | **Astro** | Best-in-class for mixing API routes with UI. |
| **Mode** | **Server (SSR)** | Required for dynamic generation. |
| **Interactivity** | **Svelte** | "Islands Architecture" keeps the profile page lightweight. |
| **Engine** | **Pseudata** | The shared logic library. |
| **Hosting** | **Vercel** | Edge network + Serverless Functions. |
| **Database** | **None** | All state is in the UUID or Signed Tokens. |

---

## 6. Implementation Hints

### A. Astro Directory Structure
This maps the URL structure directly to the file system.

```text
src/
├── components/
│   ├── ProfileCard.svelte    # Svelte Island for the UI
│   └── ...
├── lib/
│   ├── pseudo-id.ts          # Logic to Encode/Decode UUID v8
│   ├── oidc.ts               # JWT crypto logic
│   └── scim.ts               # SCIM Schema mapper
├── pages/
│   ├── .well-known/
│   │   └── openid-configuration.ts
│   ├── api/
│   │   └── v1/
│   │       └── [type].ts     # The Factory
│   ├── oidc/
│   │   ├── authorize.astro   # Login UI
│   │   ├── token.ts          # API
│   │   ├── introspect.ts     # API
│   │   ├── userinfo.ts       # API
│   │   └── jwks.ts           # API
│   ├── scim/
│   │   └── v2/               # NEW: Enterprise folder
│   │   │       ├── Users/
│   │   │       │   ├── [id].ts   # SCIM User Detail
│   │   │       │   └── index.ts  # SCIM User List
│   │       └── ServiceProviderConfig.ts
│   └── u/
│       ├── lookup.ts         # Redirector
│       └── [id]/
│           ├── index.astro   # Profile Page
│           ├── contact.vcf.ts# VCard
│           ├── cover.png.ts  # Banner Image
│           └── ...
└── astro.config.mjs
```

---

## 7. SEO & Indexing Strategy

To prevent search engines from crawling infinite generated pages (Spider Trap), we apply a strict **No-Index** policy on dynamic routes.

| Path | Indexing | Strategy |
| :--- | :--- | :--- |
| **`/`** (Landing) | **YES** | Standard indexing. Links to `pseudata.dev` are followed. |
| **`/u/{id}`** | **NO** | `<meta name="robots" content="noindex, nofollow" />`. |
| **`/api/*`** | **NO** | Header `X-Robots-Tag: noindex`. |
| **`/oidc/*`** | **NO** | Header `X-Robots-Tag: noindex`. |
| **`robots.txt`** | **BLOCK** | `Disallow: /u/`, `/api/`, `/oidc/`. |